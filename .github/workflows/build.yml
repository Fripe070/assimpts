name: Build

on:
    push:
    pull_request:
    workflow_dispatch:

env:
    BUILD_PATH: "."

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Bun
              uses: oven-sh/setup-bun@v2

            - name: Install dependencies
              run: bun install
              working-directory: ${{ env.BUILD_PATH }}

            - name: Setup Cpp
              uses: aminya/setup-cpp@v1
              with:
                cmake: true

            - name: Install Emscripten
              run: |
                  chmod +x ./tools/install-emscripten.sh ./tools/activate-emscripten.sh
                  ./tools/install-emscripten.sh
              working-directory: ${{ env.BUILD_PATH }}

            - name: Build
              run: bun run build
              working-directory: ${{ env.BUILD_PATH }}

            - name: Upload artifact
              uses: actions/upload-artifact@v4
              with:
                  name: "build-artifact"
                  if-no-files-found: error
                  path: ${{ env.BUILD_PATH }}/dist

    # test:
    #     runs-on: ubuntu-latest
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v4
    #           with:
    #               ref: ${{ github.head_ref }}

    #         - name: Setup Bun
    #           uses: oven-sh/setup-bun@v2

    #         - name: Install dependencies
    #           run: bun install

    #         - name: Run tests
    #           run: bun run test
